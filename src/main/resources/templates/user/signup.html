<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>íšŒì›ê°€ì…</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
body {
	height: 100vh;
	display: flex;
	align-items: center;
	justify-content: center;
	background: #f8f9fa
}

.signup-container {
	width: 520px
}
</style>
</head>
<body>
	<div class="signup-container">
		<h2 class="mb-4 text-center">íšŒì›ê°€ì…</h2>

		<form th:action="@{/user/userSignUp}" method="post" id="signupForm"
			class="border p-4 rounded bg-light needs-validation" novalidate>
			<input type="hidden" th:name="${_csrf?.parameterName}"
				th:value="${_csrf?.token}" />

			<!-- ì•„ì´ë”” -->
			<div class="mb-3">
				<label for="userId" class="form-label">ì•„ì´ë””</label>
				<div class="input-group">
					<input type="text" id="userId" name="userId" class="form-control"
						required minlength="4" maxlength="30" pattern="[a-zA-Z0-9_]{4,30}"
						placeholder="ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´, 4~30ì">
					<button type="button" class="btn btn-outline-secondary"
						id="btnCheckId">ì¤‘ë³µ ê²€ì‚¬</button>
				</div>
				<div class="form-text">ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ì‚¬ìš©</div>
				<div class="invalid-feedback">ì•„ì´ë”” í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.</div>
				<div id="idCheckMsg" class="small mt-1"></div>
			</div>

			<!-- ë¹„ë°€ë²ˆí˜¸ -->
			<div class="mb-3">
				<label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
				<div class="input-group">
					<input type="password" id="password" name="password"
						class="form-control" required minlength="8"
						placeholder="8ì ì´ìƒ (ê¶Œì¥: ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¡°í•©)">
					<button type="button" class="btn btn-outline-secondary"
						onclick="togglePassword('password', this)">ğŸ‘</button>
				</div>
				<div class="invalid-feedback">ë¹„ë°€ë²ˆí˜¸ë¥¼ 8ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.</div>
			</div>

			<!-- ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸ -->
			<div class="mb-3">
				<label for="password2" class="form-label">ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label>
				<div class="input-group">
					<input type="password" id="password2" class="form-control" required>
					<button type="button" class="btn btn-outline-secondary"
						onclick="togglePassword('password2', this)">ğŸ‘</button>
				</div>
				<div id="pwHelp" class="invalid-feedback">ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ë‹¤ë¦…ë‹ˆë‹¤.</div>
			</div>

			<!-- ì´ë¦„ -->
			<div class="mb-3">
				<label for="userName" class="form-label">ì´ë¦„</label> <input
					type="text" id="userName" name="userName" class="form-control"
					required>
				<div class="invalid-feedback">ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
			</div>

			<!-- ì´ë©”ì¼(ì„ íƒ) -->
			<div class="mb-3">
				<label for="userEmail" class="form-label">ì´ë©”ì¼(ì„ íƒ)</label> <input
					type="email" id="userEmail" name="userEmail" class="form-control"
					placeholder="name@example.com">
				<div class="invalid-feedback">ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.</div>
			</div>

			<!-- íœ´ëŒ€í°(ì„ íƒ) -->
			<div class="mb-3">
				<label for="userPhone" class="form-label">íœ´ëŒ€í° ë²ˆí˜¸(ì„ íƒ)</label> <input
					type="text" id="userPhone" name="userPhone" class="form-control"
					placeholder="010-1234-5678" inputmode="numeric" maxlength="13">
				<div class="form-text">ìˆ«ìë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ í•˜ì´í”ˆì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
			</div>

			<!-- ìƒë…„ì›”ì¼(ì„ íƒ) -->
			<div class="mb-3">
				<label for="birthDate" class="form-label">ìƒë…„ì›”ì¼(ì„ íƒ)</label> <input
					type="date" id="birthDate" name="birthDate" class="form-control">
				<div class="form-text">
					ì„ íƒ ì‹œ í‘œì‹œ: <span id="birthPreview">-</span>
				</div>
			</div>

			<!-- ì£¼ì†Œ(í•„ìˆ˜: DB NOT NULL ëŒ€ì‘) -->
			<div class="mb-3">
				<label for="userAddress" class="form-label">ì£¼ì†Œ</label>
				<div class="input-group">
					<input type="text" id="userAddress" name="userAddress"
						class="form-control" placeholder="ì£¼ì†Œ" required>
					<button type="button" class="btn btn-outline-secondary"
						onclick="execDaumPostcode()">ì£¼ì†Œ ê²€ìƒ‰</button>
				</div>
			</div>
			<div class="mb-3">
				<input type="text" id="detailAddress" name="detailAddress"
					class="form-control" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
			</div>

			<!-- ì¶œê¸ˆê³„ì¢Œ(ì„ íƒ) -->
			<div class="row g-2 mb-3">
				<div class="col-4">
					<label for="userBank" class="form-label">ì€í–‰</label> <select
						id="userBank" name="userBank" class="form-select">
						<option value="">ì„ íƒ</option>
						<option>êµ­ë¯¼</option>
						<option>ìš°ë¦¬</option>
						<option>ì‹ í•œ</option>
						<option>í•˜ë‚˜</option>
						<option>ë†í˜‘</option>
						<option>ì¹´ì¹´ì˜¤ë±…í¬</option>
					</select>
				</div>
				<div class="col-8">
					<label for="userBankAccount" class="form-label">ê³„ì¢Œë²ˆí˜¸</label> <input
						type="text" id="userBankAccount" name="userBankAccount"
						class="form-control" placeholder="ìˆ«ìë§Œ ì…ë ¥">
				</div>
			</div>

			<button type="submit" class="btn btn-success w-100">ê°€ì…í•˜ê¸°</button>
		</form>
	</div>


<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
function execDaumPostcode(){
	
new daum.Postcode({
    oncomplete: function(data) {
		if(data.userSelectedType=='R'){
			addr=data.roadAddress;
		}else{
			addr=data.jibunAddress;
		}
	    // ìš°í¸ë²ˆí˜¸ + ê¸°ë³¸ì£¼ì†Œ ì…ë ¥
        document.getElementById("userAddress").value = "(" + data.zonecode + ") " + addr;

        // ìƒì„¸ì£¼ì†Œ ì¹¸ìœ¼ë¡œ focus
        document.getElementById("detailAddress").focus();
    }
}).open();
}

</script>


	<script>
  // ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬(ajax ìë¦¬)
  document.getElementById('btnCheckId')?.addEventListener('click', async ()=>{
    const userId = document.getElementById('userId').value.trim();
    const msg = document.getElementById('idCheckMsg');
    if(!/^[a-zA-Z0-9_]{4,30}$/.test(userId)){
      msg.textContent = 'ì•„ì´ë”” í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.';
      msg.className = 'small text-danger';
      return;
    }
    try{
      // const res = await fetch('/api/users/check-id?userId='+encodeURIComponent(userId));
      // const {available} = await res.json();
      const available = true; // <-- ì„œë²„ ì—°ë™ ì „ ì„ì‹œ
      if(available){ msg.textContent='ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.'; msg.className='small text-success'; }
      else { msg.textContent='ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.'; msg.className='small text-danger'; }
    }catch(e){
      msg.textContent='ì¤‘ë³µ ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'; msg.className='small text-danger';
    }
  });

  // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ í† ê¸€
  function togglePassword(id, btn){
    const el = document.getElementById(id);
    const to = el.type === 'password' ? 'text' : 'password';
    el.type = to; btn.textContent = (to==='text' ? '@' : 'ğŸ‘');
  }

  // íœ´ëŒ€í° ìë™ í•˜ì´í”ˆ
  const phone = document.getElementById('userPhone');
  phone?.addEventListener('input', ()=>{
    let v = phone.value.replace(/\D/g,'').slice(0,11);
    if(v.length>7) v = v.replace(/(\d{3})(\d{4})(\d{1,4})/,'$1-$2-$3');
    else if(v.length>3) v = v.replace(/(\d{3})(\d{1,4})/,'$1-$2');
    phone.value = v;
  });

  // ìƒì¼ í”„ë¦¬ë·°
  const birth = document.getElementById('birthDate');
  const birthPreview = document.getElementById('birthPreview');
  birth?.addEventListener('change', ()=> {
    birthPreview.textContent = birth.value ? birth.value.replaceAll('-', '.') : '-';
  });



  // ì œì¶œ ê²€ì¦
  (function(){
    const form = document.getElementById('signupForm');
    const pw1 = document.getElementById('password');
    const pw2 = document.getElementById('password2');

    form.addEventListener('submit', (e)=>{
      // HTML5 ê¸°ë³¸ ê²€ì¦
      if(!form.checkValidity()){
        e.preventDefault(); e.stopPropagation();
      }
      // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜
      if(pw1.value !== pw2.value){
        e.preventDefault(); e.stopPropagation();
        pw2.classList.add('is-invalid');
        document.getElementById('pwHelp').style.display='block';
      }else{
        pw2.classList.remove('is-invalid');
      }
      form.classList.add('was-validated');
    });
  })();
</script>
</body>
</html>
